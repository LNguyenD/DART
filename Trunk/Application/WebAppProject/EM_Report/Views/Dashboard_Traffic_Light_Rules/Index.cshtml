@model List<EM_Report.Domain.Dashboard_Traffic_Light_Rule>
@using EM_Report.Common.Utilities;
@using EM_Report.Helpers;
@using EM_Report.Domain.Resources;
@{
    ViewBag.Title = "Traffic light List";
    Layout = Request.IsAjaxRequest() ? null : "~/Views/Shared/_Master.cshtml";
    var userRepository = new EM_Report.Repositories.UserRepository();
   }

<script src="@Url.ContentV("~/Scripts/iImportData.js")" type="text/javascript"></script>

<div class="Wrapper">
@Html.Hidden("controllerName", "Dashboard_Traffic_Light_Rules")
    @using (Ajax.BeginForm("Index", new AjaxOptions { UpdateTargetId = "content", OnBegin = "showLoading", OnComplete = "hideLoading" }))
    {
        @Html.AntiForgeryToken()	
        <link href="@Url.ContentV("~/Css/jquery.selectbox.css")" rel="stylesheet" type="text/css" />        
        <script type="text/javascript" src="@Url.ContentV("~/scripts/custom_javascript.js")"></script> 
        <script src="@Url.ContentV("~/scripts/iReport.js")" type="text/javascript"></script>
        <link href="@Url.ContentV("~/Css/report.css")" rel="stylesheet" type="text/css" />
       
        @Html.Partial("_SearchBar")
        <div class="w_100p">
            @using (Html.BeginForm())
            {
                <div class="formWrap">
                    <h1>
                        Traffic light List</h1>
                    <table name="tbGrid" cellspacing="0" cellpadding="0" class="tbl">
                        <thead>
                            <tr>                               
                                <td sortby="SystemId" sortdir="" class="col_10">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>System Name
                                </td>
                                <td sortby="DashboardType" sortdir="" class="col_15">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>Dashboard Type
                                </td>                               
                                <td sortby="Name" sortdir="" class="col_10">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>Name
                                </td>
                                <td sortby="Description" sortdir="" class="col_25">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>Description
                                </td>
                                <td sortby="FromValue" sortdir="" class="col_10">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>From Value
                                </td>
                                <td sortby="ToValue" sortdir="" class="col_10">
                                    <span class="css_right ui-icon ui-icon-carat-2-n-s"></span>To Value
                                </td>                               
                            </tr>
                        </thead>
                        @if (!ViewData.Model.IsNullOrEmpty())
                        {
                            var i = 0;         
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr class="@(i % 2 == 0 ? "odd" : "even") ShowTargetItem">                                       
                                        <td title="@userRepository.GetSystemNameById(item.SystemId)">
                                            <a href="@Url.Action("Details", "Dashboard_Traffic_Light_Rules", new { id = item.Id, systemid = ViewBag.currentSystemId })">@item.SystemId</a>
                                        </td>
                                        <td title="@item.DashboardType">@item.DashboardType
                                        </td>                                       
                                        <td title="@item.Name">@item.Name
                                        </td>
                                        <td title="@item.Description">@item.Description
                                        </td>
                                        <td title="@(item.FromValue)">@item.FromValue
                                        </td>
                                        <td title="@(item.ToValue)">@item.ToValue
                                        </td>                                        
                                    </tr>             
                                    i++;
                                }
                            </tbody>                        
                        }
                    </table>
                    <br />
                    <div class="right">
                        @if (Login.AuthorizeSystemPermission(ResourcesHelper.System_Group, ResourcesHelper.Permission_Add))
                        {
                            <span class="btnPurple">
                                <input type="button" value="@Resource.Action_ImportExcel" onclick="window.location = ('@Url.Action("Import", "Dashboard_Traffic_Light_Rules", new { systemid = ViewBag.currentSystemId })')" /></span>
                            <span class="btnPurple">
                                <input type="button" value="@Resource.Action_AddNew" onclick="window.location = ('@Url.Action("Details", "Dashboard_Traffic_Light_Rules", new { systemid = ViewBag.currentSystemId })')"/></span>
                            <span class="btnPurple"><input type="button" id="btnDeleteAll" value="Delete All" onclick="confirmOKCancel('Confirmation', 'Are you sure you want to delete')"/></span>
                        }
                    </div>
                    <div class="Paging">
                        @if (!Model.IsNullOrEmpty())
                        {
                            @Html.Partial("_UCPaging")                                          
                        }
                    </div>
                    @Html.Partial("_HiddenAction")
                </div>
            }
        </div>   
    }
</div>
<script type="text/javascript" language="javascript">
    $(document).ready(function () {
        $(".targetSave").hide();

    });

    $(document).undelegate(".targetEdit").delegate(".targetEdit", 'click', function (e) {
        e.preventDefault();
        var parent = $(this).parents(".ShowTargetItem");
        parent.find(".txtUnitEdit").fadeIn('fast');
        parent.find(".UnitLink").hide();
        parent.find(".targetEdit").hide();
        parent.find(".targetSave").show();

        parent.siblings(".ShowTargetItem").each(function (index) {
            $(this).find(".txtUnitEdit").hide();
            $(this).find(".UnitLink").fadeIn('fast');
            $(this).find(".targetSave").hide();
            $(this).find(".targetEdit").show();
        })
    })

    $(document).undelegate(".targetSave").delegate(".targetSave", 'click', function (e) {
        e.preventDefault();
        var parent = $(this).parents(".ShowTargetItem");
        var Unit = parent.find(".txtUnitEdit").val();
        var parent = $(this).parents(".ShowTargetItem");
        parent.find(".txtUnitEdit").hide();
        parent.find(".UnitLink").fadeIn('fast');
        parent.find(".targetSave").hide();
        parent.find(".targetEdit").show();

    })

</script>
