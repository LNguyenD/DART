@model EM_Report.Domain.User_Import         
@using EM_Report.Common.Utilities;
@using EM_Report.Helpers;
@using EM_Report.Domain.Resources;
@{    
    ViewBag.Title = "Import User List";
    Layout = Request.IsAjaxRequest() ? null : "~/Views/Shared/_Master.cshtml";
}
<div class="wrapper">
    <div class="w_100p">
    @using (Html.BeginForm("Import", "User", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken()
        <div class="formWrap">
            @Html.Hidden("action")
            <input type="hidden" id="pathFileTmp" name="pathFileTmp" value="@ViewBag.PathFileTmp" />
            <h1>Import User List
             <div class="viewImport">
                <a href="#" class="linkImport"><img src="@Url.ContentV("~/images/ico_import_file.png")" alt="Show Template" title="Show Template" /> Preview template</a>
                <!-- VIEW DESCRIPTION -->
                <div class="viewImportContent">
                    <img src="@Url.ContentV("~/images/template_user.png")" alt="Template" title="Template" />
                </div>
                <!-- VIEW DESCRIPTION END -->
                <div class="clear"></div>
            </div>
            </h1>
            @Html.Partial("_ShowMessage")
            <div class="formInline">
                <label>Excel input</label>
                @Html.TextBoxFor(e => e.File, new { id = "txtExcelInput", name = "txtExcelInput", @class = "Text", type = "file", accept = ".csv" })
                <span class="field-validation-error" style="display: none">*</span>
            </div>   
            <div class="clear"></div>
            <div class="formInline formInlineBtn">
                <span class="btnPurple"><input type="button" id="cmdProcess" value="Process" onclick="ProcessImportingData()"/></span>
            </div>
            <br />
            <table name="tbGrid" cellspacing="0" cellpadding="0" class="tbl">
                <thead>
                    <tr>
                        <td class="col_10"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>system id</td>
                        <td class="col_17"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>username</td>
                        <td class="col_17"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>password</td>
                        <td class="col_17"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>first name</td>
                        <td class="col_17"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>last name</td>
                        <td class="col_25"><span class="css_right ui-icon ui-icon-carat-2-n-s"></span>email</td>
                    </tr>
                </thead>
                @if (Model != null && !Model.UserList.IsNullOrEmpty())
                {
                    var i = 0;
                    <tbody>
                        @foreach (var item in Model.UserList)
                        {
                            <tr class="@(item.IsError ? "err" : (i % 2 == 0 ? "odd" : "even"))">
                                <td class="@(item.ErrorFields.Contains("system") ? "err" : "")" title="@(item.ErrorFields.Contains("system") ? "System Id is not valid" : item.SystemId.ToString())" style="width:*%;">@item.SystemId</td>
                                <td class="@(item.ErrorFields.Contains("username") ? "err" : "")" title="@(item.ErrorFields.Contains("username") ? "Username is not valid" : item.UserName)" style="width:*%;">@item.UserName</td>
                                <td class="@(item.ErrorFields.Contains("password") ? "err" : "")" title="@(item.ErrorFields.Contains("password") ? "Password is not valid" : item.Password)" style="width:*%;">******</td>
                                <td class="@(item.ErrorFields.Contains("firstname") ? "err" : "")" title="@(item.ErrorFields.Contains("firstname") ? "First name is not valid" : item.FirstName)" style="width:*%;">@item.FirstName</td>
                                <td class="@(item.ErrorFields.Contains("lastname") ? "err" : "")" title="@(item.ErrorFields.Contains("lastname") ? "Last name is not valid" : item.LastName)" style="width:*%;">@item.LastName</td>
                                <td class="@(item.ErrorFields.Contains("email") ? "err" : "")" title="@(item.ErrorFields.Contains("email") ? "Email is not valid" : item.Email)" style="width:*%;">@item.Email</td>
                            </tr>
                                                                                                                                                                                              i++;
                        }
                    </tbody>
                }            
            </table>
            <br />
            <div class="right">
                <span class="btnPurple"><input type="button" value="Save" onclick="SubmitImportingData()"/></span>
            </div>
            <div class="clear"></div>
        </div>
    }
    </div>
</div>
<script type="text/javascript" language="javascript">
    function ProcessImportingData() {
        var isValid = true;

        if ($("#txtExcelInput").val() == "") {
            $("#txtExcelInput").addClass("input-validation-error");
            $("#txtExcelInput").next().show();
            isValid = false;
        }
        else {
            $("#txtExcelInput").next().hide();
        }

        if (isValid) 
        {
            actionClick('process', false);
        }
    }

    function SubmitImportingData() {
        var isValid = true;

        if ($("#pathFileTmp").attr("value") == "") {
            if ($("#txtExcelInput").val() == "") {
                $("#txtExcelInput").addClass("input-validation-error");
                $("#txtExcelInput").next().show();
                isValid = false;
            }
            else {
                $("#txtExcelInput").next().hide();
            }
        }

        if (isValid) {
            actionClick('save', false);
        }
    }
</script>